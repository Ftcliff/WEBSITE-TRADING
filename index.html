<!DOCTYPE html>
<html>
<head>
<title>Trading Firm - Advanced Analytics</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:Inter,sans-serif;
  background:#0b1220;
  color:#fff;
  display:flex;
}
.sidebar{
  width:250px;
  background:#111827;
  height:100vh;
  padding:30px;
  position:fixed;
}
.sidebar h2{color:#38bdf8;margin-bottom:40px}
.main{
  margin-left:260px;
  padding:40px;
  width:100%;
}
.kpis{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:20px;
  margin-bottom:30px;
}
.card{
  background:#111827;
  padding:20px;
  border-radius:14px;
}
.card h4{color:#9ca3af;margin-bottom:5px}
.card h2{color:#38bdf8}
.filters{
  margin-bottom:30px;
}
select,input{
  padding:10px;
  margin-right:10px;
  border-radius:6px;
  border:none;
}
table{
  width:100%;
  border-collapse:collapse;
  background:#111827;
  border-radius:14px;
  overflow:hidden;
  margin-top:20px;
}
th,td{
  padding:12px;
  border-bottom:1px solid #1f2937;
}
th{background:#1f2937;color:#38bdf8}
canvas{
  background:#111827;
  padding:20px;
  border-radius:14px;
  margin-bottom:30px;
}
@media(max-width:900px){
.sidebar{display:none}
.main{margin-left:0}
}
</style>
</head>

<body>

<div class="sidebar">
  <h2>üè¢ TRADING FIRM</h2>
</div>

<div class="main">

<h1 style="margin-bottom:30px;">Advanced Performance Dashboard</h1>

<div class="filters">
  <select id="traderSelect"></select>
  <input type="date" id="startDate">
  <input type="date" id="endDate">
  <button onclick="applyFilters()">Filter</button>
</div>

<div class="kpis">
  <div class="card"><h4>Total Funds</h4><h2 id="funds">$0</h2></div>
  <div class="card"><h4>Total Profit</h4><h2 id="profit">$0</h2></div>
  <div class="card"><h4>ROI %</h4><h2 id="roi">0%</h2></div>
</div>

<canvas id="lineChart"></canvas>

<table>
<thead>
<tr>
<th>Date</th>
<th>Funds Given</th>
<th>Profit Made</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

</div>

<script>

const API = "https://script.google.com/macros/s/AKfycbzsL7At4Mv7l0MxUe-ECE8CQSsOeDNg_kgvnyy86r1kzo0dHNxXYkp8bXITQc866M8iAw/exec";
let allData = [];
let chart;

async function loadData(){
  const res = await fetch(API);
  const json = await res.json();
  allData = json.data.slice(1).map(r=>({
    trader:r[0],
    date:r[1],
    funds:parseFloat(r[2]),
    profit:parseFloat(r[3])
  })).filter(r=>r.trader && !isNaN(r.funds) && !isNaN(r.profit));

  const traders = [...new Set(allData.map(r=>r.trader))];
  const select = document.getElementById("traderSelect");
  select.innerHTML = '<option value="All">All Traders</option>';
  traders.forEach(t=>{
    select.innerHTML += `<option value="${t}">${t}</option>`;
  });

  applyFilters();
}

function applyFilters(){

  const trader = document.getElementById("traderSelect").value;
  const start = document.getElementById("startDate").value;
  const end = document.getElementById("endDate").value;

  let filtered = allData;

  if(trader !== "All")
    filtered = filtered.filter(r=>r.trader===trader);

  if(start)
    filtered = filtered.filter(r=>r.date>=start);

  if(end)
    filtered = filtered.filter(r=>r.date<=end);

  updateDashboard(filtered);
}

function updateDashboard(data){

  if(data.length===0) return;

  let totalFunds=0;
  let totalProfit=0;
  let dates=[];
  let profits=[];

  data.sort((a,b)=>a.date.localeCompare(b.date));

  data.forEach(r=>{
    totalFunds+=r.funds;
    totalProfit+=r.profit;
    dates.push(r.date);
    profits.push(r.profit);
  });

  const roi = (totalProfit/totalFunds)*100;

  document.getElementById("funds").innerText="$"+totalFunds.toFixed(2);
  document.getElementById("profit").innerText="$"+totalProfit.toFixed(2);
  document.getElementById("roi").innerText=roi.toFixed(2)+"%";

  const tbody=document.getElementById("tableBody");
  tbody.innerHTML="";
  data.forEach(r=>{
    tbody.innerHTML+=`
    <tr>
      <td>${r.date}</td>
      <td>$${r.funds}</td>
      <td>$${r.profit}</td>
    </tr>`;
  });

  if(chart) chart.destroy();

  chart=new Chart(document.getElementById("lineChart"),{
    type:'line',
    data:{
      labels:dates,
      datasets:[{
        label:"Profit Over Time",
        data:profits
      }]
    }
  });
}

loadData();

</script>

</body>
</html>
