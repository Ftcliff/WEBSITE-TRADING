<!DOCTYPE html>
<html>
<head>
<title>Trading Firm Enterprise</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:Inter, sans-serif;
  background:#0b1220;
  color:#fff;
  display:flex;
}
.sidebar{
  width:250px;
  background:#111827;
  height:100vh;
  padding:30px;
  position:fixed;
}
.sidebar h2{
  color:#38bdf8;
  margin-bottom:40px;
}
.sidebar div{
  padding:15px;
  margin-bottom:10px;
  color:#9ca3af;
}
.main{
  margin-left:260px;
  padding:40px;
  width:100%;
}
.kpis{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:20px;
  margin-bottom:40px;
}
.card{
  background:#111827;
  padding:25px;
  border-radius:16px;
}
.card h4{color:#9ca3af;margin-bottom:8px}
.card h2{color:#38bdf8;font-size:28px}
table{
  width:100%;
  border-collapse:collapse;
  background:#111827;
  border-radius:16px;
  overflow:hidden;
}
th,td{
  padding:14px;
  border-bottom:1px solid #1f2937;
}
th{background:#1f2937;color:#38bdf8}
.leader{color:#22c55e;font-weight:bold}
canvas{
  background:#111827;
  padding:20px;
  border-radius:16px;
  margin-bottom:40px;
}
@media(max-width:900px){
  .sidebar{display:none}
  .main{margin-left:0}
}
</style>
</head>

<body>

<div class="sidebar">
  <h2>üè¢ TRADING FIRM</h2>
  <div>Dashboard</div>
  <div>Analytics</div>
  <div>Leaderboard</div>
  <div>Admin</div>
</div>

<div class="main">

<h1 style="margin-bottom:30px;">Enterprise Dashboard</h1>

<div class="kpis">
  <div class="card"><h4>Total Profit</h4><h2 id="total">$0</h2></div>
  <div class="card"><h4>Top Trader</h4><h2 id="top">-</h2></div>
  <div class="card"><h4>Average Trade</h4><h2 id="avg">$0</h2></div>
  <div class="card"><h4>Growth %</h4><h2 id="growth">0%</h2></div>
</div>

<canvas id="barChart"></canvas>

<h3 style="margin-bottom:15px;">Leaderboard</h3>
<table>
<thead>
<tr>
<th>Rank</th>
<th>Trader</th>
<th>Total Profit</th>
</tr>
</thead>
<tbody id="leaderboard"></tbody>
</table>

</div>

<script>

const API = "https://script.google.com/macros/s/AKfycbzsL7At4Mv7l0MxUe-ECE8CQSsOeDNg_kgvnyy86r1kzo0dHNxXYkp8bXITQc866M8iAw/exec";

let chartInstance;

async function loadData(){

  const response = await fetch(API);
  const result = await response.json();
  const rows = result.data.slice(1).filter(r => r[0] && !isNaN(parseFloat(r[1])));

  if(rows.length === 0) return;

  let total = 0;
  let traderTotals = {};
  let labels = [];
  let values = [];

  rows.forEach(r=>{
    const name = r[0].toString().trim();
    const amount = parseFloat(r[1]);

    total += amount;

    traderTotals[name] = (traderTotals[name] || 0) + amount;
  });

  const sorted = Object.entries(traderTotals).sort((a,b)=>b[1]-a[1]);

  labels = sorted.map(t=>t[0]);
  values = sorted.map(t=>t[1]);

  const avg = total / rows.length;

  let growth = 0;
  if(values.length > 1 && values[0] !== 0){
    growth = ((values[0] - values[values.length-1]) / values[values.length-1]) * 100;
  }

  document.getElementById("total").innerText = "$"+total.toFixed(2);
  document.getElementById("avg").innerText = "$"+avg.toFixed(2);
  document.getElementById("top").innerText = sorted[0][0];
  document.getElementById("growth").innerText = growth.toFixed(2)+"%";

  const tbody = document.getElementById("leaderboard");
  tbody.innerHTML="";
  sorted.forEach((t,i)=>{
    tbody.innerHTML += `
    <tr>
      <td>${i+1}</td>
      <td class="${i==0?'leader':''}">${t[0]}</td>
      <td>$${t[1].toFixed(2)}</td>
    </tr>`;
  });

  if(chartInstance) chartInstance.destroy();

  chartInstance = new Chart(document.getElementById("barChart"),{
    type:'bar',
    data:{
      labels:labels,
      datasets:[{
        label:"Trader Profits",
        data:values
      }]
    }
  });

}

loadData();
setInterval(loadData,30000);

</script>

</body>
</html>
